var ft=Object.defineProperty;var pt=(p,e,t)=>e in p?ft(p,e,{enumerable:!0,configurable:!0,writable:!0,value:t}):p[e]=t;var M=(p,e,t)=>pt(p,typeof e!="symbol"?e+"":e,t);(function(){const e=document.createElement("link").relList;if(e&&e.supports&&e.supports("modulepreload"))return;for(const i of document.querySelectorAll('link[rel="modulepreload"]'))s(i);new MutationObserver(i=>{for(const r of i)if(r.type==="childList")for(const u of r.addedNodes)u.tagName==="LINK"&&u.rel==="modulepreload"&&s(u)}).observe(document,{childList:!0,subtree:!0});function t(i){const r={};return i.integrity&&(r.integrity=i.integrity),i.referrerPolicy&&(r.referrerPolicy=i.referrerPolicy),i.crossOrigin==="use-credentials"?r.credentials="include":i.crossOrigin==="anonymous"?r.credentials="omit":r.credentials="same-origin",r}function s(i){if(i.ep)return;i.ep=!0;const r=t(i);fetch(i.href,r)}})();/*! chessboard.js v1.0.0 | (c) 2019 Chris Oakman | MIT License chessboardjs.com/license */(function(){var p=window.jQuery,e="abcdefgh".split(""),t=20,s="â€¦",i="1.8.3",r="rnbqkbnr/pppppppp/8/8/8/8/PPPPPPPP/RNBQKBNR",u=Se(r),a=200,d=200,b=60,C=30,O=100,o={};function q(h,l,T){function I(){A=0,K&&(K=!1,x())}var A=0,K=!1,j=[],x=function(){A=window.setTimeout(I,l),h.apply(T,j)};return function(F){j=arguments,A?K=!0:x()}}function _(){return"xxxx-xxxx-xxxx-xxxx-xxxx-xxxx-xxxx-xxxx".replace(/x/g,function(h){return(16*Math.random()|0).toString(16)})}function v(h){return JSON.parse(JSON.stringify(h))}function N(h){var l=h.split(".");return{major:parseInt(l[0],10),minor:parseInt(l[1],10),patch:parseInt(l[2],10)}}function L(h,l){for(var T in l)if(l.hasOwnProperty(T))for(var I="{"+T+"}",A=l[T];h.indexOf(I)!==-1;)h=h.replace(I,A);return h}function Q(h){return typeof h=="string"}function S(h){return typeof h=="function"}function z(h){return typeof h=="number"&&isFinite(h)&&Math.floor(h)===h}function V(h){return h==="fast"||h==="slow"||!!z(h)&&0<=h}function ve(h){if(!Q(h))return!1;var l=h.split("-");return l.length===2&&X(l[0])&&X(l[1])}function X(h){return Q(h)&&h.search(/^[a-h][1-8]$/)!==-1}function ge(h){return Q(h)&&h.search(/^[bw][KQRNBP]$/)!==-1}function he(h){if(!Q(h))return!1;var l=(h=function(I){return I.replace(/8/g,"11111111").replace(/7/g,"1111111").replace(/6/g,"111111").replace(/5/g,"11111").replace(/4/g,"1111").replace(/3/g,"111").replace(/2/g,"11")}(h=h.replace(/ .+$/,""))).split("/");if(l.length!==8)return!1;for(var T=0;T<8;T++)if(l[T].length!==8||l[T].search(/[^kqrnbpKQRNBP1]/)!==-1)return!1;return!0}function Pe(h){if(!p.isPlainObject(h))return!1;for(var l in h)if(h.hasOwnProperty(l)&&(!X(l)||!ge(h[l])))return!1;return!0}function Je(){return typeof window.$&&p.fn&&p.fn.jquery&&function(h,l){h=N(h),l=N(l);var T=1e5*h.major*1e5+1e5*h.minor+h.patch;return 1e5*l.major*1e5+1e5*l.minor+l.patch<=T}(p.fn.jquery,i)}function Se(h){if(!he(h))return!1;for(var l,T=(h=h.replace(/ .+$/,"")).split("/"),I={},A=8,K=0;K<8;K++){for(var j=T[K].split(""),x=0,F=0;F<j.length;F++)j[F].search(/[1-8]/)!==-1?x+=parseInt(j[F],10):(I[e[x]+A]=(l=j[F]).toLowerCase()===l?"b"+l.toUpperCase():"w"+l.toUpperCase(),x+=1);A-=1}return I}function ye(h){if(!Pe(h))return!1;for(var l,T,I="",A=8,K=0;K<8;K++){for(var j=0;j<8;j++){var x=e[j]+A;h.hasOwnProperty(x)?I+=(l=h[x],T=void 0,(T=l.split(""))[0]==="w"?T[1].toUpperCase():T[1].toLowerCase()):I+="1"}K!==7&&(I+="/"),A-=1}return I=function(F){return F.replace(/11111111/g,"8").replace(/1111111/g,"7").replace(/111111/g,"6").replace(/11111/g,"5").replace(/1111/g,"4").replace(/111/g,"3").replace(/11/g,"2")}(I)}function ze(h,l,T){for(var I=function(j){for(var x=[],F=0;F<8;F++)for(var B=0;B<8;B++){var k=e[F]+(B+1);j!==k&&x.push({square:k,distance:(ie=j,se=k,$=ie.split(""),ee=e.indexOf($[0])+1,ce=parseInt($[1],10),D=se.split(""),oe=e.indexOf(D[0])+1,H=parseInt(D[1],10),re=Math.abs(ee-oe),_e=Math.abs(ce-H),_e<=re?re:_e)})}var ie,se,$,ee,ce,D,oe,H,re,_e;x.sort(function(me,Ae){return me.distance-Ae.distance});var ne=[];for(F=0;F<x.length;F++)ne.push(x[F].square);return ne}(T),A=0;A<I.length;A++){var K=I[A];if(h.hasOwnProperty(K)&&h[K]===l)return K}return!1}function Ve(h){return h.orientation!=="black"&&(h.orientation="white"),h.showNotation!==!1&&(h.showNotation=!0),h.draggable!==!0&&(h.draggable=!1),h.dropOffBoard!=="trash"&&(h.dropOffBoard="snapback"),h.sparePieces!==!0&&(h.sparePieces=!1),h.sparePieces&&(h.draggable=!0),h.hasOwnProperty("pieceTheme")&&(Q(h.pieceTheme)||S(h.pieceTheme))||(h.pieceTheme="img/chesspieces/wikipedia/{piece}.png"),V(h.appearSpeed)||(h.appearSpeed=a),V(h.moveSpeed)||(h.moveSpeed=d),V(h.snapbackSpeed)||(h.snapbackSpeed=b),V(h.snapSpeed)||(h.snapSpeed=C),V(h.trashSpeed)||(h.trashSpeed=O),function(l){return z(l)&&1<=l}(h.dragThrottleRate)||(h.dragThrottleRate=t),h}o.alpha="alpha-d2270",o.black="black-3c85d",o.board="board-b72b1",o.chessboard="chessboard-63f37",o.clearfix="clearfix-7da63",o.highlight1="highlight1-32417",o.highlight2="highlight2-9c5d2",o.notation="notation-322f9",o.numeric="numeric-fc462",o.piece="piece-417db",o.row="row-5277c",o.sparePieces="spare-pieces-7492f",o.sparePiecesBottom="spare-pieces-bottom-ae20f",o.sparePiecesTop="spare-pieces-top-4028b",o.square="square-55d63",o.white="white-1e1d7",window.Chessboard=function(h,l){if(!function(){if(Je())return!0;var n="Chessboard Error 1005: Unable to find a valid version of jQuery. Please include jQuery "+i+` or higher on the page

Exiting`+s;return window.alert(n),!1}())return null;var T=function(n){if(n===""){var c=`Chessboard Error 1001: The first argument to Chessboard() cannot be an empty string.

Exiting`+s;return window.alert(c),!1}Q(n)&&n.charAt(0)!=="#"&&(n="#"+n);var f=p(n);if(f.length===1)return f;var g=`Chessboard Error 1003: The first argument to Chessboard() must be the ID of a DOM node, an ID query selector, or a single DOM node.

Exiting`+s;return window.alert(g),!1}(h);if(!T)return null;l=Ve(l=function(n){return n==="start"?n={position:v(u)}:he(n)?n={position:Se(n)}:Pe(n)&&(n={position:v(n)}),p.isPlainObject(n)||(n={}),n}(l));var I=null,A=null,K=null,j=null,x={},F=2,B="white",k={},ie=null,se=null,$=null,ee=!1,ce={},D={},oe={},H=16;function re(n,c,f){if(l.hasOwnProperty("showErrors")===!0&&l.showErrors!==!1){var g="Chessboard Error "+n+": "+c;return l.showErrors==="console"&&typeof console=="object"&&typeof console.log=="function"?(console.log(g),void(2<=arguments.length&&console.log(f))):l.showErrors==="alert"?(f&&(g+=`

`+JSON.stringify(f)),void window.alert(g)):void(S(l.showErrors)&&l.showErrors(n,c,f))}}function _e(n){return S(l.pieceTheme)?l.pieceTheme(n):Q(l.pieceTheme)?L(l.pieceTheme,{piece:n}):(re(8272,"Unable to build image source for config.pieceTheme."),"")}function ne(n,c,f){var g='<img src="'+_e(n)+'" ';return Q(f)&&f!==""&&(g+='id="'+f+'" '),g+='alt="" class="{piece}" data-piece="'+n+'" style="width:'+H+"px;height:"+H+"px;",c&&(g+="display:none;"),L(g+='" />',o)}function me(n){var c=["wK","wQ","wR","wB","wN","wP"];n==="black"&&(c=["bK","bQ","bR","bB","bN","bP"]);for(var f="",g=0;g<c.length;g++)f+=ne(c[g],!1,ce[c[g]]);return f}function Ae(n,c,f,g){var P=p("#"+D[n]),R=P.offset(),m=p("#"+D[c]),y=m.offset(),G=_();p("body").append(ne(f,!0,G));var Ee=p("#"+G);Ee.css({display:"",position:"absolute",top:R.top,left:R.left}),P.find("."+o.piece).remove();var ct={duration:l.moveSpeed,complete:function(){m.append(ne(f)),Ee.remove(),S(g)&&g()}};Ee.animate(y,ct)}function Ze(n,c,f){var g=p("#"+ce[n]).offset(),P=p("#"+D[c]),R=P.offset(),m=_();p("body").append(ne(n,!0,m));var y=p("#"+m);y.css({display:"",position:"absolute",left:g.left,top:g.top});var G={duration:l.moveSpeed,complete:function(){P.find("."+o.piece).remove(),P.append(ne(n)),y.remove(),S(f)&&f()}};y.animate(R,G)}function be(){for(var n in I.find("."+o.piece).remove(),k)k.hasOwnProperty(n)&&p("#"+D[n]).append(ne(k[n]))}function qe(){I.html(function(n){n!=="black"&&(n="white");var c="",f=v(e),g=8;n==="black"&&(f.reverse(),g=1);for(var P="white",R=0;R<8;R++){c+='<div class="{row}">';for(var m=0;m<8;m++){var y=f[m]+g;c+='<div class="{square} '+o[P]+" square-"+y+'" style="width:'+H+"px;height:"+H+'px;" id="'+D[y]+'" data-square="'+y+'">',l.showNotation&&((n==="white"&&g===1||n==="black"&&g===8)&&(c+='<div class="{notation} {alpha}">'+f[m]+"</div>"),m===0&&(c+='<div class="{notation} {numeric}">'+g+"</div>")),c+="</div>",P=P==="white"?"black":"white"}c+='<div class="{clearfix}"></div></div>',P=P==="white"?"black":"white",n==="white"?g-=1:g+=1}return L(c,o)}(B,l.showNotation)),be(),l.sparePieces&&(B==="white"?(K.html(me("black")),j.html(me("white"))):(K.html(me("white")),j.html(me("black"))))}function Te(n){var c=v(k),f=v(n);ye(c)!==ye(f)&&(S(l.onChange)&&l.onChange(c,f),k=n)}function Re(n,c){for(var f in oe)if(oe.hasOwnProperty(f)){var g=oe[f];if(n>=g.left&&n<g.left+H&&c>=g.top&&c<g.top+H)return f}return"offboard"}function Me(){I.find("."+o.square).removeClass(o.highlight1+" "+o.highlight2)}function je(){Me();var n=v(k);delete n[$],Te(n),be(),A.fadeOut(l.trashSpeed),ee=!1}function Oe(n,c,f,g){S(l.onDragStart)&&l.onDragStart(n,c,v(k),B)===!1||(ee=!0,ie=c,se=($=n)==="spare"?"offboard":n,function(){for(var P in oe={},D)D.hasOwnProperty(P)&&(oe[P]=p("#"+D[P]).offset())}(),A.attr("src",_e(c)).css({display:"",position:"absolute",left:f-H/2,top:g-H/2}),n!=="spare"&&p("#"+D[n]).addClass(o.highlight1).find("."+o.piece).css("display","none"))}function $e(n,c){A.css({left:n-H/2,top:c-H/2});var f=Re(n,c);f!==se&&(X(se)&&p("#"+D[se]).removeClass(o.highlight2),X(f)&&p("#"+D[f]).addClass(o.highlight2),S(l.onDragMove)&&l.onDragMove(f,se,$,ie,v(k),B),se=f)}function He(n){var c="drop";if(n==="offboard"&&l.dropOffBoard==="snapback"&&(c="snapback"),n==="offboard"&&l.dropOffBoard==="trash"&&(c="trash"),S(l.onDrop)){var f=v(k);$==="spare"&&X(n)&&(f[n]=ie),X($)&&n==="offboard"&&delete f[$],X($)&&X(n)&&(delete f[$],f[n]=ie);var g=v(k),P=l.onDrop($,n,ie,f,g,B);P!=="snapback"&&P!=="trash"||(c=P)}c==="snapback"?function(){if($!=="spare"){Me();var R=p("#"+D[$]).offset(),m={duration:l.snapbackSpeed,complete:function(){be(),A.css("display","none"),S(l.onSnapbackEnd)&&l.onSnapbackEnd(ie,$,v(k),B)}};A.animate(R,m),ee=!1}else je()}():c==="trash"?je():c==="drop"&&function(R){Me();var m=v(k);delete m[$],m[R]=ie,Te(m);var y=p("#"+D[R]).offset(),G={duration:l.snapSpeed,complete:function(){be(),A.css("display","none"),S(l.onSnapEnd)&&l.onSnapEnd($,R,ie)}};A.animate(y,G),ee=!1}(n)}function et(n){n.preventDefault()}function tt(n){if(l.draggable){var c=p(this).attr("data-square");X(c)&&k.hasOwnProperty(c)&&Oe(c,k[c],n.pageX,n.pageY)}}function it(n){if(l.draggable){var c=p(this).attr("data-square");X(c)&&k.hasOwnProperty(c)&&(n=n.originalEvent,Oe(c,k[c],n.changedTouches[0].pageX,n.changedTouches[0].pageY))}}function nt(n){l.sparePieces&&Oe("spare",p(this).attr("data-piece"),n.pageX,n.pageY)}function st(n){l.sparePieces&&Oe("spare",p(this).attr("data-piece"),(n=n.originalEvent).changedTouches[0].pageX,n.changedTouches[0].pageY)}x.clear=function(n){x.position({},n)},x.destroy=function(){T.html(""),A.remove(),T.unbind()},x.fen=function(){return x.position("fen")},x.flip=function(){return x.orientation("flip")},x.move=function(){if(arguments.length!==0){for(var n=!0,c={},f=0;f<arguments.length;f++)if(arguments[f]!==!1)if(ve(arguments[f])){var g=arguments[f].split("-");c[g[0]]=g[1]}else re(2826,"Invalid move passed to the move method.",arguments[f]);else n=!1;var P=function(R,m){var y=v(R);for(var G in m)if(m.hasOwnProperty(G)&&y.hasOwnProperty(G)){var Ee=y[G];delete y[G],y[m[G]]=Ee}return y}(k,c);return x.position(P,n),P}},x.orientation=function(n){return arguments.length===0?B:n==="white"||n==="black"?(B=n,qe(),B):n==="flip"?(B=B==="white"?"black":"white",qe(),B):void re(5482,"Invalid value passed to the orientation method.",n)},x.position=function(n,c){if(arguments.length===0)return v(k);if(Q(n)&&n.toLowerCase()==="fen")return ye(k);Q(n)&&n.toLowerCase()==="start"&&(n=v(u)),he(n)&&(n=Se(n)),Pe(n)?(c!==!1&&(c=!0),c?(function(f,g,P){if(f.length!==0)for(var R=0,m=0;m<f.length;m++){var y=f[m];y.type==="clear"?p("#"+D[y.square]+" ."+o.piece).fadeOut(l.trashSpeed,G):y.type!=="add"||l.sparePieces?y.type==="add"&&l.sparePieces?Ze(y.piece,y.square,G):y.type==="move"&&Ae(y.source,y.destination,y.piece,G):p("#"+D[y.square]).append(ne(y.piece,!0)).find("."+o.piece).fadeIn(l.appearSpeed,G)}function G(){(R+=1)===f.length&&(be(),S(l.onMoveEnd)&&l.onMoveEnd(v(g),v(P)))}}(function(f,g){f=v(f),g=v(g);var P=[],R={};for(var m in g)g.hasOwnProperty(m)&&f.hasOwnProperty(m)&&f[m]===g[m]&&(delete f[m],delete g[m]);for(m in g)if(g.hasOwnProperty(m)){var y=ze(f,g[m],m);y&&(P.push({type:"move",source:y,destination:m,piece:g[m]}),delete f[y],delete g[m],R[m]=!0)}for(m in g)g.hasOwnProperty(m)&&(P.push({type:"add",square:m,piece:g[m]}),delete g[m]);for(m in f)f.hasOwnProperty(m)&&(R.hasOwnProperty(m)||(P.push({type:"clear",square:m,piece:f[m]}),delete f[m]));return P}(k,n),k,n),Te(n)):(Te(n),be())):re(6482,"Invalid value passed to the position method.",n)},x.resize=function(){H=function(){var n=parseInt(T.width(),10);if(!n||n<=0)return 0;for(var c=n-1;c%8!=0&&0<c;)c-=1;return c/8}(),I.css("width",8*H+"px"),A.css({height:H,width:H}),l.sparePieces&&T.find("."+o.sparePieces).css("paddingLeft",H+F+"px"),qe()},x.start=function(n){x.position("start",n)};var rt=q(function(n){ee&&$e(n.pageX,n.pageY)},l.dragThrottleRate),ot=q(function(n){ee&&(n.preventDefault(),$e(n.originalEvent.changedTouches[0].pageX,n.originalEvent.changedTouches[0].pageY))},l.dragThrottleRate);function at(n){ee&&He(Re(n.pageX,n.pageY))}function lt(n){ee&&He(Re(n.originalEvent.changedTouches[0].pageX,n.originalEvent.changedTouches[0].pageY))}function ut(n){if(!ee&&S(l.onMouseoverSquare)){var c=p(n.currentTarget).attr("data-square");if(X(c)){var f=!1;k.hasOwnProperty(c)&&(f=k[c]),l.onMouseoverSquare(c,f,v(k),B)}}}function ht(n){if(!ee&&S(l.onMouseoutSquare)){var c=p(n.currentTarget).attr("data-square");if(X(c)){var f=!1;k.hasOwnProperty(c)&&(f=k[c]),l.onMouseoutSquare(c,f,v(k),B)}}}return B=l.orientation,l.hasOwnProperty("position")&&(l.position==="start"?k=v(u):he(l.position)?k=Se(l.position):Pe(l.position)?k=v(l.position):re(7263,"Invalid value passed to config.position.",l.position)),function(){(function(){for(var c=0;c<e.length;c++)for(var f=1;f<=8;f++){var g=e[c]+f;D[g]=g+"-"+_()}var P="KQRNBP".split("");for(c=0;c<P.length;c++){var R="w"+P[c],m="b"+P[c];ce[R]=R+"-"+_(),ce[m]=m+"-"+_()}})(),T.html(function(c){var f='<div class="{chessboard}">';return c&&(f+='<div class="{sparePieces} {sparePiecesTop}"></div>'),f+='<div class="{board}"></div>',c&&(f+='<div class="{sparePieces} {sparePiecesBottom}"></div>'),L(f+="</div>",o)}(l.sparePieces)),I=T.find("."+o.board),l.sparePieces&&(K=T.find("."+o.sparePiecesTop),j=T.find("."+o.sparePiecesBottom));var n=_();p("body").append(ne("wP",!0,n)),A=p("#"+n),F=parseInt(I.css("borderLeftWidth"),10),x.resize()}(),function(){p("body").on("mousedown mousemove","."+o.piece,et),I.on("mousedown","."+o.square,tt),T.on("mousedown","."+o.sparePieces+" ."+o.piece,nt),I.on("mouseenter","."+o.square,ut).on("mouseleave","."+o.square,ht);var n=p(window);n.on("mousemove",rt).on("mouseup",at),"ontouchstart"in document.documentElement&&(I.on("touchstart","."+o.square,it),T.on("touchstart","."+o.sparePieces+" ."+o.piece,st),n.on("touchmove",ot).on("touchend",lt))}(),x},window.ChessBoard=window.Chessboard,window.Chessboard.fenToObj=Se,window.Chessboard.objToFen=ye})();/**
 * @license
 * Copyright (c) 2025, Jeff Hlywa (jhlywa@gmail.com)
 * All rights reserved.
 *
 * Redistribution and use in source and binary forms, with or without
 * modification, are permitted provided that the following conditions are met:
 *
 * 1. Redistributions of source code must retain the above copyright notice,
 *    this list of conditions and the following disclaimer.
 * 2. Redistributions in binary form must reproduce the above copyright notice,
 *    this list of conditions and the following disclaimer in the documentation
 *    and/or other materials provided with the distribution.
 *
 * THIS SOFTWARE IS PROVIDED BY THE COPYRIGHT HOLDERS AND CONTRIBUTORS "AS IS"
 * AND ANY EXPRESS OR IMPLIED WARRANTIES, INCLUDING, BUT NOT LIMITED TO, THE
 * IMPLIED WARRANTIES OF MERCHANTABILITY AND FITNESS FOR A PARTICULAR PURPOSE
 * ARE DISCLAIMED. IN NO EVENT SHALL THE COPYRIGHT OWNER OR CONTRIBUTORS BE
 * LIABLE FOR ANY DIRECT, INDIRECT, INCIDENTAL, SPECIAL, EXEMPLARY, OR
 * CONSEQUENTIAL DAMAGES (INCLUDING, BUT NOT LIMITED TO, PROCUREMENT OF
 * SUBSTITUTE GOODS OR SERVICES; LOSS OF USE, DATA, OR PROFITS; OR BUSINESS
 * INTERRUPTION) HOWEVER CAUSED AND ON ANY THEORY OF LIABILITY, WHETHER IN
 * CONTRACT, STRICT LIABILITY, OR TORT (INCLUDING NEGLIGENCE OR OTHERWISE)
 * ARISING IN ANY WAY OUT OF THE USE OF THIS SOFTWARE, EVEN IF ADVISED OF THE
 * POSSIBILITY OF SUCH DAMAGE.
 */const J="w",te="b",W="p",Be="n",Ne="b",Ce="r",ue="q",U="k",Le="rnbqkbnr/pppppppp/8/8/8/8/PPPPPPPP/RNBQKBNR w KQkq - 0 1";class xe{constructor(e,t){M(this,"color");M(this,"from");M(this,"to");M(this,"piece");M(this,"captured");M(this,"promotion");M(this,"flags");M(this,"san");M(this,"lan");M(this,"before");M(this,"after");const{color:s,piece:i,from:r,to:u,flags:a,captured:d,promotion:b}=t,C=Y(r),O=Y(u);this.color=s,this.piece=i,this.from=C,this.to=O,this.san=e._moveToSan(t,e._moves({legal:!0})),this.lan=C+O,this.before=e.fen(),e._makeMove(t),this.after=e.fen(),e._undoMove(),this.flags="";for(const o in w)w[o]&a&&(this.flags+=fe[o]);d&&(this.captured=d),b&&(this.promotion=b,this.lan+=b)}isCapture(){return this.flags.indexOf(fe.CAPTURE)>-1}isPromotion(){return this.flags.indexOf(fe.PROMOTION)>-1}isEnPassant(){return this.flags.indexOf(fe.EP_CAPTURE)>-1}isKingsideCastle(){return this.flags.indexOf(fe.KSIDE_CASTLE)>-1}isQueensideCastle(){return this.flags.indexOf(fe.QSIDE_CASTLE)>-1}isBigPawn(){return this.flags.indexOf(fe.BIG_PAWN)>-1}}const Z=-1,fe={NORMAL:"n",CAPTURE:"c",BIG_PAWN:"b",EP_CAPTURE:"e",PROMOTION:"p",KSIDE_CASTLE:"k",QSIDE_CASTLE:"q"},w={NORMAL:1,CAPTURE:2,BIG_PAWN:4,EP_CAPTURE:8,PROMOTION:16,KSIDE_CASTLE:32,QSIDE_CASTLE:64},Ue={Event:"?",Site:"?",Date:"????.??.??",Round:"?",White:"?",Black:"?",Result:"*"},dt={WhiteTitle:null,BlackTitle:null,WhiteElo:null,BlackElo:null,WhiteUSCF:null,BlackUSCF:null,WhiteNA:null,BlackNA:null,WhiteType:null,BlackType:null,EventDate:null,EventSponsor:null,Section:null,Stage:null,Board:null,Opening:null,Variation:null,SubVariation:null,ECO:null,NIC:null,Time:null,UTCTime:null,UTCDate:null,TimeControl:null,SetUp:null,FEN:null,Termination:null,Annotator:null,Mode:null,PlyCount:null},gt={...Ue,...dt},E={a8:0,b8:1,c8:2,d8:3,e8:4,f8:5,g8:6,h8:7,a7:16,b7:17,c7:18,d7:19,e7:20,f7:21,g7:22,h7:23,a6:32,b6:33,c6:34,d6:35,e6:36,f6:37,g6:38,h6:39,a5:48,b5:49,c5:50,d5:51,e5:52,f5:53,g5:54,h5:55,a4:64,b4:65,c4:66,d4:67,e4:68,f4:69,g4:70,h4:71,a3:80,b3:81,c3:82,d3:83,e3:84,f3:85,g3:86,h3:87,a2:96,b2:97,c2:98,d2:99,e2:100,f2:101,g2:102,h2:103,a1:112,b1:113,c1:114,d1:115,e1:116,f1:117,g1:118,h1:119},De={b:[16,32,17,15],w:[-16,-32,-17,-15]},We={n:[-18,-33,-31,-14,18,33,31,14],b:[-17,-15,17,15],r:[-16,1,16,-1],q:[-17,-16,-15,1,17,16,15,-1],k:[-17,-16,-15,1,17,16,15,-1]},_t=[20,0,0,0,0,0,0,24,0,0,0,0,0,0,20,0,0,20,0,0,0,0,0,24,0,0,0,0,0,20,0,0,0,0,20,0,0,0,0,24,0,0,0,0,20,0,0,0,0,0,0,20,0,0,0,24,0,0,0,20,0,0,0,0,0,0,0,0,20,0,0,24,0,0,20,0,0,0,0,0,0,0,0,0,0,20,2,24,2,20,0,0,0,0,0,0,0,0,0,0,0,2,53,56,53,2,0,0,0,0,0,0,24,24,24,24,24,24,56,0,56,24,24,24,24,24,24,0,0,0,0,0,0,2,53,56,53,2,0,0,0,0,0,0,0,0,0,0,0,20,2,24,2,20,0,0,0,0,0,0,0,0,0,0,20,0,0,24,0,0,20,0,0,0,0,0,0,0,0,20,0,0,0,24,0,0,0,20,0,0,0,0,0,0,20,0,0,0,0,24,0,0,0,0,20,0,0,0,0,20,0,0,0,0,0,24,0,0,0,0,0,20,0,0,20,0,0,0,0,0,0,24,0,0,0,0,0,0,20],mt=[17,0,0,0,0,0,0,16,0,0,0,0,0,0,15,0,0,17,0,0,0,0,0,16,0,0,0,0,0,15,0,0,0,0,17,0,0,0,0,16,0,0,0,0,15,0,0,0,0,0,0,17,0,0,0,16,0,0,0,15,0,0,0,0,0,0,0,0,17,0,0,16,0,0,15,0,0,0,0,0,0,0,0,0,0,17,0,16,0,15,0,0,0,0,0,0,0,0,0,0,0,0,17,16,15,0,0,0,0,0,0,0,1,1,1,1,1,1,1,0,-1,-1,-1,-1,-1,-1,-1,0,0,0,0,0,0,0,-15,-16,-17,0,0,0,0,0,0,0,0,0,0,0,0,-15,0,-16,0,-17,0,0,0,0,0,0,0,0,0,0,-15,0,0,-16,0,0,-17,0,0,0,0,0,0,0,0,-15,0,0,0,-16,0,0,0,-17,0,0,0,0,0,0,-15,0,0,0,0,-16,0,0,0,0,-17,0,0,0,0,-15,0,0,0,0,0,-16,0,0,0,0,0,-17,0,0,-15,0,0,0,0,0,0,-16,0,0,0,0,0,0,-17],bt={p:1,n:2,b:4,r:8,q:16,k:32},vt="pnbrqkPNBRQK",Ge=[Be,Ne,Ce,ue],St=7,Et=6,wt=1,Ct=0,Ie={[U]:w.KSIDE_CASTLE,[ue]:w.QSIDE_CASTLE},ae={w:[{square:E.a1,flag:w.QSIDE_CASTLE},{square:E.h1,flag:w.KSIDE_CASTLE}],b:[{square:E.a8,flag:w.QSIDE_CASTLE},{square:E.h8,flag:w.KSIDE_CASTLE}]},kt={b:wt,w:Et},Pt=["1-0","0-1","1/2-1/2","*"];function pe(p){return p>>4}function ke(p){return p&15}function Xe(p){return"0123456789".indexOf(p)!==-1}function Y(p){const e=ke(p),t=pe(p);return"abcdefgh".substring(e,e+1)+"87654321".substring(t,t+1)}function we(p){return p===J?te:J}function yt(p){const e=p.split(/\s+/);if(e.length!==6)return{ok:!1,error:"Invalid FEN: must contain six space-delimited fields"};const t=parseInt(e[5],10);if(isNaN(t)||t<=0)return{ok:!1,error:"Invalid FEN: move number must be a positive integer"};const s=parseInt(e[4],10);if(isNaN(s)||s<0)return{ok:!1,error:"Invalid FEN: half move counter number must be a non-negative integer"};if(!/^(-|[abcdefgh][36])$/.test(e[3]))return{ok:!1,error:"Invalid FEN: en-passant square is invalid"};if(/[^kKqQ-]/.test(e[2]))return{ok:!1,error:"Invalid FEN: castling availability is invalid"};if(!/^(w|b)$/.test(e[1]))return{ok:!1,error:"Invalid FEN: side-to-move is invalid"};const i=e[0].split("/");if(i.length!==8)return{ok:!1,error:"Invalid FEN: piece data does not contain 8 '/'-delimited rows"};for(let u=0;u<i.length;u++){let a=0,d=!1;for(let b=0;b<i[u].length;b++)if(Xe(i[u][b])){if(d)return{ok:!1,error:"Invalid FEN: piece data is invalid (consecutive number)"};a+=parseInt(i[u][b],10),d=!0}else{if(!/^[prnbqkPRNBQK]$/.test(i[u][b]))return{ok:!1,error:"Invalid FEN: piece data is invalid (invalid piece)"};a+=1,d=!1}if(a!==8)return{ok:!1,error:"Invalid FEN: piece data is invalid (too many squares in rank)"}}if(e[3][1]=="3"&&e[1]=="w"||e[3][1]=="6"&&e[1]=="b")return{ok:!1,error:"Invalid FEN: illegal en-passant square"};const r=[{color:"white",regex:/K/g},{color:"black",regex:/k/g}];for(const{color:u,regex:a}of r){if(!a.test(e[0]))return{ok:!1,error:`Invalid FEN: missing ${u} king`};if((e[0].match(a)||[]).length>1)return{ok:!1,error:`Invalid FEN: too many ${u} kings`}}return Array.from(i[0]+i[7]).some(u=>u.toUpperCase()==="P")?{ok:!1,error:"Invalid FEN: some pawns are on the edge rows"}:{ok:!0}}function Tt(p,e){const t=p.from,s=p.to,i=p.piece;let r=0,u=0,a=0;for(let d=0,b=e.length;d<b;d++){const C=e[d].from,O=e[d].to,o=e[d].piece;i===o&&t!==C&&s===O&&(r++,pe(t)===pe(C)&&u++,ke(t)===ke(C)&&a++)}return r>0?u>0&&a>0?Y(t):a>0?Y(t).charAt(1):Y(t).charAt(0):""}function le(p,e,t,s,i,r=void 0,u=w.NORMAL){const a=pe(s);if(i===W&&(a===St||a===Ct))for(let d=0;d<Ge.length;d++){const b=Ge[d];p.push({color:e,from:t,to:s,piece:i,captured:r,promotion:b,flags:u|w.PROMOTION})}else p.push({color:e,from:t,to:s,piece:i,captured:r,flags:u})}function Ye(p){let e=p.charAt(0);return e>="a"&&e<="h"?p.match(/[a-h]\d.*[a-h]\d/)?void 0:W:(e=e.toLowerCase(),e==="o"?U:e)}function Ke(p){return p.replace(/=/,"").replace(/[+#]?[?!]*$/,"")}function Fe(p){return p.split(" ").slice(0,4).join(" ")}class Ot{constructor(e=Le,{skipValidation:t=!1}={}){M(this,"_board",new Array(128));M(this,"_turn",J);M(this,"_header",{});M(this,"_kings",{w:Z,b:Z});M(this,"_epSquare",-1);M(this,"_halfMoves",0);M(this,"_moveNumber",0);M(this,"_history",[]);M(this,"_comments",{});M(this,"_castling",{w:0,b:0});M(this,"_positionCount",{});this.load(e,{skipValidation:t})}clear({preserveHeaders:e=!1}={}){this._board=new Array(128),this._kings={w:Z,b:Z},this._turn=J,this._castling={w:0,b:0},this._epSquare=Z,this._halfMoves=0,this._moveNumber=1,this._history=[],this._comments={},this._header=e?this._header:{...gt},this._positionCount={},this._header.SetUp=null,this._header.FEN=null}load(e,{skipValidation:t=!1,preserveHeaders:s=!1}={}){let i=e.split(/\s+/);if(i.length>=2&&i.length<6){const a=["-","-","0","1"];e=i.concat(a.slice(-(6-i.length))).join(" ")}if(i=e.split(/\s+/),!t){const{ok:a,error:d}=yt(e);if(!a)throw new Error(d)}const r=i[0];let u=0;this.clear({preserveHeaders:s});for(let a=0;a<r.length;a++){const d=r.charAt(a);if(d==="/")u+=8;else if(Xe(d))u+=parseInt(d,10);else{const b=d<"a"?J:te;this._put({type:d.toLowerCase(),color:b},Y(u)),u++}}this._turn=i[1],i[2].indexOf("K")>-1&&(this._castling.w|=w.KSIDE_CASTLE),i[2].indexOf("Q")>-1&&(this._castling.w|=w.QSIDE_CASTLE),i[2].indexOf("k")>-1&&(this._castling.b|=w.KSIDE_CASTLE),i[2].indexOf("q")>-1&&(this._castling.b|=w.QSIDE_CASTLE),this._epSquare=i[3]==="-"?Z:E[i[3]],this._halfMoves=parseInt(i[4],10),this._moveNumber=parseInt(i[5],10),this._updateSetup(e),this._incPositionCount(e)}fen(){var r,u;let e=0,t="";for(let a=E.a8;a<=E.h1;a++){if(this._board[a]){e>0&&(t+=e,e=0);const{color:d,type:b}=this._board[a];t+=d===J?b.toUpperCase():b.toLowerCase()}else e++;a+1&136&&(e>0&&(t+=e),a!==E.h1&&(t+="/"),e=0,a+=8)}let s="";this._castling[J]&w.KSIDE_CASTLE&&(s+="K"),this._castling[J]&w.QSIDE_CASTLE&&(s+="Q"),this._castling[te]&w.KSIDE_CASTLE&&(s+="k"),this._castling[te]&w.QSIDE_CASTLE&&(s+="q"),s=s||"-";let i="-";if(this._epSquare!==Z){const a=this._epSquare+(this._turn===J?16:-16),d=[a+1,a-1];for(const b of d){if(b&136)continue;const C=this._turn;if(((r=this._board[b])==null?void 0:r.color)===C&&((u=this._board[b])==null?void 0:u.type)===W){this._makeMove({color:C,from:b,to:this._epSquare,piece:W,captured:W,flags:w.EP_CAPTURE});const O=!this._isKingAttacked(C);if(this._undoMove(),O){i=Y(this._epSquare);break}}}}return[t,this._turn,s,i,this._halfMoves,this._moveNumber].join(" ")}_updateSetup(e){this._history.length>0||(e!==Le?(this._header.SetUp="1",this._header.FEN=e):(this._header.SetUp=null,this._header.FEN=null))}reset(){this.load(Le)}get(e){return this._board[E[e]]}findPiece(e){var s;const t=[];for(let i=E.a8;i<=E.h1;i++){if(i&136){i+=7;continue}!this._board[i]||((s=this._board[i])==null?void 0:s.color)!==e.color||this._board[i].color===e.color&&this._board[i].type===e.type&&t.push(Y(i))}return t}put({type:e,color:t},s){return this._put({type:e,color:t},s)?(this._updateCastlingRights(),this._updateEnPassantSquare(),this._updateSetup(this.fen()),!0):!1}_put({type:e,color:t},s){if(vt.indexOf(e.toLowerCase())===-1||!(s in E))return!1;const i=E[s];if(e==U&&!(this._kings[t]==Z||this._kings[t]==i))return!1;const r=this._board[i];return r&&r.type===U&&(this._kings[r.color]=Z),this._board[i]={type:e,color:t},e===U&&(this._kings[t]=i),!0}remove(e){const t=this.get(e);return delete this._board[E[e]],t&&t.type===U&&(this._kings[t.color]=Z),this._updateCastlingRights(),this._updateEnPassantSquare(),this._updateSetup(this.fen()),t}_updateCastlingRights(){var s,i,r,u,a,d,b,C,O,o,q,_;const e=((s=this._board[E.e1])==null?void 0:s.type)===U&&((i=this._board[E.e1])==null?void 0:i.color)===J,t=((r=this._board[E.e8])==null?void 0:r.type)===U&&((u=this._board[E.e8])==null?void 0:u.color)===te;(!e||((a=this._board[E.a1])==null?void 0:a.type)!==Ce||((d=this._board[E.a1])==null?void 0:d.color)!==J)&&(this._castling.w&=-65),(!e||((b=this._board[E.h1])==null?void 0:b.type)!==Ce||((C=this._board[E.h1])==null?void 0:C.color)!==J)&&(this._castling.w&=-33),(!t||((O=this._board[E.a8])==null?void 0:O.type)!==Ce||((o=this._board[E.a8])==null?void 0:o.color)!==te)&&(this._castling.b&=-65),(!t||((q=this._board[E.h8])==null?void 0:q.type)!==Ce||((_=this._board[E.h8])==null?void 0:_.color)!==te)&&(this._castling.b&=-33)}_updateEnPassantSquare(){var r,u;if(this._epSquare===Z)return;const e=this._epSquare+(this._turn===J?-16:16),t=this._epSquare+(this._turn===J?16:-16),s=[t+1,t-1];if(this._board[e]!==null||this._board[this._epSquare]!==null||((r=this._board[t])==null?void 0:r.color)!==we(this._turn)||((u=this._board[t])==null?void 0:u.type)!==W){this._epSquare=Z;return}const i=a=>{var d,b;return!(a&136)&&((d=this._board[a])==null?void 0:d.color)===this._turn&&((b=this._board[a])==null?void 0:b.type)===W};s.some(i)||(this._epSquare=Z)}_attacked(e,t,s){const i=[];for(let r=E.a8;r<=E.h1;r++){if(r&136){r+=7;continue}if(this._board[r]===void 0||this._board[r].color!==e)continue;const u=this._board[r],a=r-t;if(a===0)continue;const d=a+119;if(_t[d]&bt[u.type]){if(u.type===W){if(a>0&&u.color===J||a<=0&&u.color===te)if(s)i.push(Y(r));else return!0;continue}if(u.type==="n"||u.type==="k")if(s){i.push(Y(r));continue}else return!0;const b=mt[d];let C=r+b,O=!1;for(;C!==t;){if(this._board[C]!=null){O=!0;break}C+=b}if(!O)if(s){i.push(Y(r));continue}else return!0}}return s?i:!1}attackers(e,t){return t?this._attacked(t,E[e],!0):this._attacked(this._turn,E[e],!0)}_isKingAttacked(e){const t=this._kings[e];return t===-1?!1:this._attacked(we(e),t)}isAttacked(e,t){return this._attacked(t,E[e])}isCheck(){return this._isKingAttacked(this._turn)}inCheck(){return this.isCheck()}isCheckmate(){return this.isCheck()&&this._moves().length===0}isStalemate(){return!this.isCheck()&&this._moves().length===0}isInsufficientMaterial(){const e={b:0,n:0,r:0,q:0,k:0,p:0},t=[];let s=0,i=0;for(let r=E.a8;r<=E.h1;r++){if(i=(i+1)%2,r&136){r+=7;continue}const u=this._board[r];u&&(e[u.type]=u.type in e?e[u.type]+1:1,u.type===Ne&&t.push(i),s++)}if(s===2)return!0;if(s===3&&(e[Ne]===1||e[Be]===1))return!0;if(s===e[Ne]+2){let r=0;const u=t.length;for(let a=0;a<u;a++)r+=t[a];if(r===0||r===u)return!0}return!1}isThreefoldRepetition(){return this._getPositionCount(this.fen())>=3}isDrawByFiftyMoves(){return this._halfMoves>=100}isDraw(){return this.isDrawByFiftyMoves()||this.isStalemate()||this.isInsufficientMaterial()||this.isThreefoldRepetition()}isGameOver(){return this.isCheckmate()||this.isStalemate()||this.isDraw()}moves({verbose:e=!1,square:t=void 0,piece:s=void 0}={}){const i=this._moves({square:t,piece:s});return e?i.map(r=>new xe(this,r)):i.map(r=>this._moveToSan(r,i))}_moves({legal:e=!0,piece:t=void 0,square:s=void 0}={}){var q;const i=s?s.toLowerCase():void 0,r=t==null?void 0:t.toLowerCase(),u=[],a=this._turn,d=we(a);let b=E.a8,C=E.h1,O=!1;if(i)if(i in E)b=C=E[i],O=!0;else return[];for(let _=b;_<=C;_++){if(_&136){_+=7;continue}if(!this._board[_]||this._board[_].color===d)continue;const{type:v}=this._board[_];let N;if(v===W){if(r&&r!==v)continue;N=_+De[a][0],this._board[N]||(le(u,a,_,N,W),N=_+De[a][1],kt[a]===pe(_)&&!this._board[N]&&le(u,a,_,N,W,void 0,w.BIG_PAWN));for(let L=2;L<4;L++)N=_+De[a][L],!(N&136)&&(((q=this._board[N])==null?void 0:q.color)===d?le(u,a,_,N,W,this._board[N].type,w.CAPTURE):N===this._epSquare&&le(u,a,_,N,W,W,w.EP_CAPTURE))}else{if(r&&r!==v)continue;for(let L=0,Q=We[v].length;L<Q;L++){const S=We[v][L];for(N=_;N+=S,!(N&136);){if(!this._board[N])le(u,a,_,N,v);else{if(this._board[N].color===a)break;le(u,a,_,N,v,this._board[N].type,w.CAPTURE);break}if(v===Be||v===U)break}}}}if((r===void 0||r===U)&&(!O||C===this._kings[a])){if(this._castling[a]&w.KSIDE_CASTLE){const _=this._kings[a],v=_+2;!this._board[_+1]&&!this._board[v]&&!this._attacked(d,this._kings[a])&&!this._attacked(d,_+1)&&!this._attacked(d,v)&&le(u,a,this._kings[a],v,U,void 0,w.KSIDE_CASTLE)}if(this._castling[a]&w.QSIDE_CASTLE){const _=this._kings[a],v=_-2;!this._board[_-1]&&!this._board[_-2]&&!this._board[_-3]&&!this._attacked(d,this._kings[a])&&!this._attacked(d,_-1)&&!this._attacked(d,v)&&le(u,a,this._kings[a],v,U,void 0,w.QSIDE_CASTLE)}}if(!e||this._kings[a]===-1)return u;const o=[];for(let _=0,v=u.length;_<v;_++)this._makeMove(u[_]),this._isKingAttacked(a)||o.push(u[_]),this._undoMove();return o}move(e,{strict:t=!1}={}){let s=null;if(typeof e=="string")s=this._moveFromSan(e,t);else if(typeof e=="object"){const r=this._moves();for(let u=0,a=r.length;u<a;u++)if(e.from===Y(r[u].from)&&e.to===Y(r[u].to)&&(!("promotion"in r[u])||e.promotion===r[u].promotion)){s=r[u];break}}if(!s)throw typeof e=="string"?new Error(`Invalid move: ${e}`):new Error(`Invalid move: ${JSON.stringify(e)}`);const i=new xe(this,s);return this._makeMove(s),this._incPositionCount(i.after),i}_push(e){this._history.push({move:e,kings:{b:this._kings.b,w:this._kings.w},turn:this._turn,castling:{b:this._castling.b,w:this._castling.w},epSquare:this._epSquare,halfMoves:this._halfMoves,moveNumber:this._moveNumber})}_makeMove(e){const t=this._turn,s=we(t);if(this._push(e),this._board[e.to]=this._board[e.from],delete this._board[e.from],e.flags&w.EP_CAPTURE&&(this._turn===te?delete this._board[e.to-16]:delete this._board[e.to+16]),e.promotion&&(this._board[e.to]={type:e.promotion,color:t}),this._board[e.to].type===U){if(this._kings[t]=e.to,e.flags&w.KSIDE_CASTLE){const i=e.to-1,r=e.to+1;this._board[i]=this._board[r],delete this._board[r]}else if(e.flags&w.QSIDE_CASTLE){const i=e.to+1,r=e.to-2;this._board[i]=this._board[r],delete this._board[r]}this._castling[t]=0}if(this._castling[t]){for(let i=0,r=ae[t].length;i<r;i++)if(e.from===ae[t][i].square&&this._castling[t]&ae[t][i].flag){this._castling[t]^=ae[t][i].flag;break}}if(this._castling[s]){for(let i=0,r=ae[s].length;i<r;i++)if(e.to===ae[s][i].square&&this._castling[s]&ae[s][i].flag){this._castling[s]^=ae[s][i].flag;break}}e.flags&w.BIG_PAWN?t===te?this._epSquare=e.to-16:this._epSquare=e.to+16:this._epSquare=Z,e.piece===W?this._halfMoves=0:e.flags&(w.CAPTURE|w.EP_CAPTURE)?this._halfMoves=0:this._halfMoves++,t===te&&this._moveNumber++,this._turn=s}undo(){const e=this._undoMove();if(e){const t=new xe(this,e);return this._decPositionCount(t.after),t}return null}_undoMove(){const e=this._history.pop();if(e===void 0)return null;const t=e.move;this._kings=e.kings,this._turn=e.turn,this._castling=e.castling,this._epSquare=e.epSquare,this._halfMoves=e.halfMoves,this._moveNumber=e.moveNumber;const s=this._turn,i=we(s);if(this._board[t.from]=this._board[t.to],this._board[t.from].type=t.piece,delete this._board[t.to],t.captured)if(t.flags&w.EP_CAPTURE){let r;s===te?r=t.to-16:r=t.to+16,this._board[r]={type:W,color:i}}else this._board[t.to]={type:t.captured,color:i};if(t.flags&(w.KSIDE_CASTLE|w.QSIDE_CASTLE)){let r,u;t.flags&w.KSIDE_CASTLE?(r=t.to+1,u=t.to-1):(r=t.to-2,u=t.to+1),this._board[r]=this._board[u],delete this._board[u]}return t}pgn({newline:e=`
`,maxWidth:t=0}={}){const s=[];let i=!1;for(const o in this._header)this._header[o]&&s.push(`[${o} "${this._header[o]}"]`+e),i=!0;i&&this._history.length&&s.push(e);const r=o=>{const q=this._comments[this.fen()];if(typeof q<"u"){const _=o.length>0?" ":"";o=`${o}${_}{${q}}`}return o},u=[];for(;this._history.length>0;)u.push(this._undoMove());const a=[];let d="";for(u.length===0&&a.push(r(""));u.length>0;){d=r(d);const o=u.pop();if(!o)break;if(!this._history.length&&o.color==="b"){const q=`${this._moveNumber}. ...`;d=d?`${d} ${q}`:q}else o.color==="w"&&(d.length&&a.push(d),d=this._moveNumber+".");d=d+" "+this._moveToSan(o,this._moves({legal:!0})),this._makeMove(o)}if(d.length&&a.push(r(d)),a.push(this._header.Result||"*"),t===0)return s.join("")+a.join(" ");const b=function(){return s.length>0&&s[s.length-1]===" "?(s.pop(),!0):!1},C=function(o,q){for(const _ of q.split(" "))if(_){if(o+_.length>t){for(;b();)o--;s.push(e),o=0}s.push(_),o+=_.length,s.push(" "),o++}return b()&&o--,o};let O=0;for(let o=0;o<a.length;o++){if(O+a[o].length>t&&a[o].includes("{")){O=C(O,a[o]);continue}O+a[o].length>t&&o!==0?(s[s.length-1]===" "&&s.pop(),s.push(e),O=0):o!==0&&(s.push(" "),O++),s.push(a[o]),O+=a[o].length}return s.join("")}header(...e){for(let t=0;t<e.length;t+=2)typeof e[t]=="string"&&typeof e[t+1]=="string"&&(this._header[e[t]]=e[t+1]);return this._header}setHeader(e,t){return this._header[e]=t??Ue[e]??null,this.getHeaders()}removeHeader(e){return e in this._header?(this._header[e]=Ue[e]||null,!0):!1}getHeaders(){const e={};for(const[t,s]of Object.entries(this._header))s!==null&&(e[t]=s);return e}loadPgn(e,{strict:t=!1,newlineChar:s=`\r?
`}={}){function i(S){return S.replace(/\\/g,"\\")}function r(S){const z={},V=S.split(new RegExp(i(s)));let ve="",X="";for(let ge=0;ge<V.length;ge++){const he=/^\s*\[\s*([A-Za-z]+)\s*"(.*)"\s*\]\s*$/;ve=V[ge].replace(he,"$1"),X=V[ge].replace(he,"$2"),ve.trim().length>0&&(z[ve]=X)}return z}e=e.trim();const a=new RegExp("^(\\[((?:"+i(s)+")|.)*\\])((?:\\s*"+i(s)+"){2}|(?:\\s*"+i(s)+")*$)").exec(e),d=a&&a.length>=2?a[1]:"";this.reset();const b=r(d);let C="";for(const S in b)S.toLowerCase()==="fen"&&(C=b[S]),this.header(S,b[S]);if(!t)C&&this.load(C,{preserveHeaders:!0});else if(b.SetUp==="1"){if(!("FEN"in b))throw new Error("Invalid PGN: FEN tag must be supplied with SetUp tag");this.load(b.FEN,{preserveHeaders:!0})}function O(S){return Array.from(S).map(function(z){return z.charCodeAt(0)<128?z.charCodeAt(0).toString(16):encodeURIComponent(z).replace(/%/g,"").toLowerCase()}).join("")}function o(S){return S.length==0?"":decodeURIComponent("%"+(S.match(/.{1,2}/g)||[]).join("%"))}const q=function(S){return S=S.replace(new RegExp(i(s),"g")," "),`{${O(S.slice(1,S.length-1))}}`},_=function(S){if(S.startsWith("{")&&S.endsWith("}"))return o(S.slice(1,S.length-1))};let v=e.replace(d,"").replace(new RegExp(`({[^}]*})+?|;([^${i(s)}]*)`,"g"),function(S,z,V){return z!==void 0?q(z):" "+q(`{${V.slice(1)}}`)}).replace(new RegExp(i(s),"g")," ");const N=/(\([^()]+\))+?/g;for(;N.test(v);)v=v.replace(N,"");v=v.replace(/\d+\.(\.\.)?/g,""),v=v.replace(/\.\.\./g,""),v=v.replace(/\$\d+/g,"");let L=v.trim().split(new RegExp(/\s+/));L=L.filter(S=>S!=="");let Q="";for(let S=0;S<L.length;S++){const z=_(L[S]);if(z!==void 0){this._comments[this.fen()]=z;continue}const V=this._moveFromSan(L[S],t);if(V==null)if(Pt.indexOf(L[S])>-1)Q=L[S];else throw new Error(`Invalid move in PGN: ${L[S]}`);else Q="",this._makeMove(V),this._incPositionCount(this.fen())}Q&&Object.keys(this._header).length&&this._header.Result!==Q&&this.setHeader("Result",Q)}_moveToSan(e,t){let s="";if(e.flags&w.KSIDE_CASTLE)s="O-O";else if(e.flags&w.QSIDE_CASTLE)s="O-O-O";else{if(e.piece!==W){const i=Tt(e,t);s+=e.piece.toUpperCase()+i}e.flags&(w.CAPTURE|w.EP_CAPTURE)&&(e.piece===W&&(s+=Y(e.from)[0]),s+="x"),s+=Y(e.to),e.promotion&&(s+="="+e.promotion.toUpperCase())}return this._makeMove(e),this.isCheck()&&(this.isCheckmate()?s+="#":s+="+"),this._undoMove(),s}_moveFromSan(e,t=!1){const s=Ke(e);let i=Ye(s),r=this._moves({legal:!0,piece:i});for(let o=0,q=r.length;o<q;o++)if(s===Ke(this._moveToSan(r[o],r)))return r[o];if(t)return null;let u,a,d,b,C,O=!1;if(a=s.match(/([pnbrqkPNBRQK])?([a-h][1-8])x?-?([a-h][1-8])([qrbnQRBN])?/),a?(u=a[1],d=a[2],b=a[3],C=a[4],d.length==1&&(O=!0)):(a=s.match(/([pnbrqkPNBRQK])?([a-h]?[1-8]?)x?-?([a-h][1-8])([qrbnQRBN])?/),a&&(u=a[1],d=a[2],b=a[3],C=a[4],d.length==1&&(O=!0))),i=Ye(s),r=this._moves({legal:!0,piece:u||i}),!b)return null;for(let o=0,q=r.length;o<q;o++)if(d){if((!u||u.toLowerCase()==r[o].piece)&&E[d]==r[o].from&&E[b]==r[o].to&&(!C||C.toLowerCase()==r[o].promotion))return r[o];if(O){const _=Y(r[o].from);if((!u||u.toLowerCase()==r[o].piece)&&E[b]==r[o].to&&(d==_[0]||d==_[1])&&(!C||C.toLowerCase()==r[o].promotion))return r[o]}}else if(s===Ke(this._moveToSan(r[o],r)).replace("x",""))return r[o];return null}ascii(){let e=`   +------------------------+
`;for(let t=E.a8;t<=E.h1;t++){if(ke(t)===0&&(e+=" "+"87654321"[pe(t)]+" |"),this._board[t]){const s=this._board[t].type,r=this._board[t].color===J?s.toUpperCase():s.toLowerCase();e+=" "+r+" "}else e+=" . ";t+1&136&&(e+=`|
`,t+=8)}return e+=`   +------------------------+
`,e+="     a  b  c  d  e  f  g  h",e}perft(e){const t=this._moves({legal:!1});let s=0;const i=this._turn;for(let r=0,u=t.length;r<u;r++)this._makeMove(t[r]),this._isKingAttacked(i)||(e-1>0?s+=this.perft(e-1):s++),this._undoMove();return s}turn(){return this._turn}board(){const e=[];let t=[];for(let s=E.a8;s<=E.h1;s++)this._board[s]==null?t.push(null):t.push({square:Y(s),type:this._board[s].type,color:this._board[s].color}),s+1&136&&(e.push(t),t=[],s+=8);return e}squareColor(e){if(e in E){const t=E[e];return(pe(t)+ke(t))%2===0?"light":"dark"}return null}history({verbose:e=!1}={}){const t=[],s=[];for(;this._history.length>0;)t.push(this._undoMove());for(;;){const i=t.pop();if(!i)break;e?s.push(new xe(this,i)):s.push(this._moveToSan(i,this._moves())),this._makeMove(i)}return s}_getPositionCount(e){const t=Fe(e);return this._positionCount[t]||0}_incPositionCount(e){const t=Fe(e);this._positionCount[t]===void 0&&(this._positionCount[t]=0),this._positionCount[t]+=1}_decPositionCount(e){const t=Fe(e);this._positionCount[t]===1?delete this._positionCount[t]:this._positionCount[t]-=1}_pruneComments(){const e=[],t={},s=i=>{i in this._comments&&(t[i]=this._comments[i])};for(;this._history.length>0;)e.push(this._undoMove());for(s(this.fen());;){const i=e.pop();if(!i)break;this._makeMove(i),s(this.fen())}this._comments=t}getComment(){return this._comments[this.fen()]}setComment(e){this._comments[this.fen()]=e.replace("{","[").replace("}","]")}deleteComment(){return this.removeComment()}removeComment(){const e=this._comments[this.fen()];return delete this._comments[this.fen()],e}getComments(){return this._pruneComments(),Object.keys(this._comments).map(e=>({fen:e,comment:this._comments[e]}))}deleteComments(){return this.removeComments()}removeComments(){return this._pruneComments(),Object.keys(this._comments).map(e=>{const t=this._comments[e];return delete this._comments[e],{fen:e,comment:t}})}setCastlingRights(e,t){for(const i of[U,ue])t[i]!==void 0&&(t[i]?this._castling[e]|=Ie[i]:this._castling[e]&=~Ie[i]);this._updateCastlingRights();const s=this.getCastlingRights(e);return(t[U]===void 0||t[U]===s[U])&&(t[ue]===void 0||t[ue]===s[ue])}getCastlingRights(e){return{[U]:(this._castling[e]&Ie[U])!==0,[ue]:(this._castling[e]&Ie[ue])!==0}}moveNumber(){return this._moveNumber}}let Qe=null;const de=new Ot;function xt(p,e,t,s){if(de.isGameOver()||de.turn()===te||e.search(/^b/)!==-1)return!1}function It(){const p=de.moves();if(p.length===0)return;const e=Math.floor(Math.random()*p.length);de.move(p[e]),Qe.position(de.fen())}function Nt(p,e){try{de.move({from:p,to:e,promotion:"q"})}catch{return"snapback"}window.setTimeout(It,250)}function At(){Qe.position(de.fen())}const qt={draggable:!0,position:"start",onDragStart:xt,onDrop:Nt,onSnapEnd:At};Qe=Chessboard("myBoard",qt);
